---
title: ステージング専用パイプラインと実稼動専用パイプラインの分割
description: 専用パイプラインを使用してステージングデプロイメントと実稼動デプロイメントを分割する方法について説明します。
exl-id: b7dd0021-d346-464a-a49e-72864b01cce3
source-git-commit: 35845e827b0a3fadfe2a55a2171b5e02100cf3eb
workflow-type: tm+mt
source-wordcount: '924'
ht-degree: 98%

---

# ステージのみのパイプラインと実稼動のみのパイプラインの分割 {#stage-prod-only}

専用パイプラインを使用してステージングデプロイメントと実稼動デプロイメントを分割する方法について説明します。

## 概要 {#overview}

ステージング環境と実稼動環境は緊密に結び付いています。デフォルトでは、それらに対するデプロイメントは単一のパイプラインにリンクされます。これは、そのプログラムのステージング環境と実稼動環境の両方にデプロイされるデプロイメントパイプラインです。この結合は通常は適切ですが、デメリットが存在する特定のユースケースがあります。

* ステージング専用環境にデプロイする場合は、パイプラインの&#x200B;**実稼動環境に昇格**&#x200B;手順を拒否します。ただし、実行はキャンセルとしてマークされます。
* ステージング環境の最新コードを実稼動環境にデプロイする場合は、コードが変更されていなくても、ステージングデプロイメントを含むパイプライン全体を再デプロイする必要があります。
* デプロイメント中は環境を更新できません。実稼動環境に昇格する前にステージング環境で数日間一時停止してテストする場合、実稼動環境はロックされたままになり、更新できません。このシナリオにより、[環境変数](/help/getting-started/build-environment.md#environment-variables)の更新などの非依存タスクが不可能になります。

ステージング専用パイプラインと実稼動専用パイプラインは、専用のデプロイメントオプションを提供することで、これらのユースケースに対するソリューションを提供します。

* **ステージング専用デプロイメントパイプライン：**&#x200B;ステージング環境にのみデプロイされ、デプロイメントとテストが完了すると実行が終了します。ステージング専用パイプラインは、標準の結合されたフルスタック実稼動パイプラインと同じように動作しますが、実稼動環境のデプロイメント手順（承認、スケジュール、デプロイ）はありません。
* **実稼動専用デプロイメントパイプライン：**&#x200B;最新の成功したステージ実行を選択して、実稼動環境にのみデプロイします。次に、そのアーティファクトを実稼動環境にデプロイします。実稼動専用パイプラインは、ステージデプロイメントアーティファクトを再利用し、ビルドフェーズをバイパスします。

フルスタック実稼動パイプラインの進行中は、ステージング専用パイプラインと実稼動専用パイプラインは実行されません。その逆も同様です。ステージング専用パイプラインとフルスタック実稼動パイプラインの両方に **Git の変更時**&#x200B;トリガーが設定され、同じブランチとリポジトリを指している場合、ステージング専用パイプラインのみが自動的に開始されます。実稼動専用パイプラインはリポジトリに直接リンクされていないので、**`On Git Changes`** には開始されません。

実稼動専用パイプラインは、**Git の変更時**&#x200B;のリポジトリに直接リンクされていないので、手動でトリガーされます。

これらの専用パイプラインはより柔軟性に優れていますが、次の操作の詳細と推奨事項に注意する必要があります。

>[!NOTE]
>
>実稼動専用パイプラインは、常にステージング専用パイプラインからのアーティファクトを利用します。このプロセスは、標準の結合された実稼動パイプラインがその間にステージング環境に他のものをデプロイした場合でも当てはまります。
>
>* このようなシナリオにより、不要なコードのロールバックが発生する可能性があります。
>* アドビでは、実稼動専用パイプラインとステージング専用パイプラインの使用を開始したら、結合された標準の実稼動パイプラインの使用を停止することをお勧めします。
>* 引き続き標準の結合パイプラインとステージング専用パイプライン／実稼動専用パイプラインの両方を実行することにした場合は、コードのロールバックを回避するためにアーティファクトの再利用を念頭に置いてください。

## パイプラインの作成 {#pipeline-creation}

実稼動専用パイプラインとステージング専用パイプラインは、標準の[実稼動パイプライン](/help/using/production-pipelines.md)と[実稼動以外のパイプライン](/help/using/non-production-pipelines.md)の結合と同様の方法で作成されます。詳しくは、これらの資料を参照してください。

1. **パイプライン**&#x200B;ウィンドウで、「**パイプラインを追加**」をクリックします。

   * ステージング専用パイプラインを作成するには、「**実稼動以外のパイプラインを追加**」を選択します。
   * 実稼動専用パイプラインを作成するには、「**実稼動専用パイプラインを追加**」を選択します。

   ![実稼動専用パイプライン／ステージング専用パイプラインの作成](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>対応するパイプラインが既に存在する場合、特定のオプションはグレー表示される場合があります。
>
>* ステージング専用パイプラインがまだ存在しない場合、「**実稼動専用パイプラインを追加**」は使用できません。
>* 標準の結合パイプラインが既に存在する場合、「**実稼動パイプラインを追加**」は使用できません。
>* プログラム別に許可される実稼動専用パイプラインとステージング専用パイプラインは 1 つだけです。

### ステージング専用パイプライン {#stage-only}

1. 「**実稼動以外のパイプラインを追加**」オプションを選択すると、**実稼動以外のパイプラインを追加**&#x200B;ダイアログボックスが開きます。
1. ステージング専用パイプラインを作成するには、パイプラインの「**適格なデプロイメント環境**」フィールドでステージング環境を選択します。
1. 残りのフィールドに入力します。
1. 「**続行**」をクリックします。

   ![ステージング専用パイプラインの作成](/help/assets/configure-pipelines/stage-only.png)

1. 「**ステージテスト**」タブで、ステージング環境で実行するテストを定義します。
1. 「**保存**」をクリックします。

   ![ステージング専用パイプラインのテストパラメーター](/help/assets/configure-pipelines/stage-only-test.png)

### 実稼動専用パイプライン {#prod-only}

1. 「**実稼動専用パイプラインを追加**」オプションを選択すると、**実稼動専用パイプラインを追加**&#x200B;ダイアログが開きます。
1. 「**パイプライン名**」フィールドに、目的の名前を入力します。ダイアログの残りのオプションと機能は、標準の結合パイプライン作成ダイアログボックスにあるオプションと同じように動作します。
1. ダイアログボックスの右下隅にある「**保存**」をクリックします。

   ![実稼動専用パイプラインの作成](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 実稼動専用パイプラインとステージング専用パイプラインの実行 {#running}

実稼動専用パイプラインとステージング専用パイプラインは、[他のすべてのパイプラインとほぼ同じ方法で実行されます](/help/using/managing-pipelines.md#running-pipelines)。詳しくは、そのドキュメントを参照してください。ただし、これらのパイプラインには 2 つの新機能があります。

* ステージング専用および実稼動専用のパイプラインには、テストをスキップする新しい[緊急モード](#emergency-mode)が用意されています。
* [ステージング専用パイプライン](#stage-only-run)の実行の詳細から、実稼動専用パイプラインの実行を直接トリガーできます。

### 緊急モード {#emergency-mode}

実稼動専用パイプラインとステージングオンラインパイプラインを開始する際には、開始とその開始方法を確認するように求められます。

* **通常モード**&#x200B;は標準的な実行方法で、ステージテストの手順が含まれます。
* **緊急モード**&#x200B;ではステージテスト手順をスキップします。

![緊急モード](/help/assets/configure-pipelines/emergency-mode.png)

### ステージング専用パイプライン {#stage-only-run}

ステージング専用パイプラインは、標準の結合パイプラインとほとんど同じ方法で実行されます。ただし、実行の最後、テスト手順の後に「**ビルドを昇格**」ボタンが表示されます。このボタンを使用すると、実行中にステージにデプロイされたアーティファクトを使用して実稼動専用のパイプライン実行を開始し、それらを実稼動環境にデプロイできます。

![ステージング専用パイプラインの実行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

「**ビルドを昇格**」をクリックすると、関連するステージング専用パイプラインの実行を、通常または[緊急モード](#emergency-mode)で確認するように求められます。

実稼動専用パイプラインが存在しない場合は、パイプラインを作成するよう求められます。

### 実稼動専用パイプライン {#prod-only-run}

実稼動専用パイプラインの場合は、実稼動環境にデプロイするソースアーティファクトを必ず特定します。詳しくは、**アーティファクトの準備**&#x200B;手順を参照してください。これらの実行に移動すると、詳細やログを確認できます。

![アーティファクトの詳細](/help/assets/configure-pipelines/prod-only-pipeline-run.png)

