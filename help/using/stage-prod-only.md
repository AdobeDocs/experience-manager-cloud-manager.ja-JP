---
title: ステージ専用パイプラインと実稼動専用パイプライン
description: 専用パイプラインを使用してステージングデプロイメントと実稼動デプロイメントを分割する方法について説明します。
exl-id: b7dd0021-d346-464a-a49e-72864b01cce3
source-git-commit: 8e2c57d2594691e7fb18d8a538caa9b54a26b6bb
workflow-type: tm+mt
source-wordcount: '932'
ht-degree: 27%

---

# ステージング専用パイプラインと実稼動用パイプライン {#stage-prod-only}

専用パイプラインを使用してステージングデプロイメントと実稼動デプロイメントを分割する方法について説明します。

>[!NOTE]
>
>この機能は、[ 早期導入プログラム ](/help/release-notes/current.md#early-adoption) でのみ使用できます。

## 概要 {#overview}

ステージング環境と実稼動環境は緊密に結び付いています。デフォルトでは、それらに対するデプロイメントは単一のパイプラインにリンクされます。つまり、デプロイメントパイプラインは、そのプログラムのステージング環境と実稼動環境の両方にデプロイされます。 この結合は通常は適切ですが、デメリットが存在する特定のユースケースがあります。

* ステージングのみにデプロイする場合は、パイプラインの **実稼動環境に昇格** ステップを拒否します。 ただし、実行はキャンセルとマークされます。
* ステージング環境で最新のコードを実稼動環境にデプロイする場合は、コードが変更されていなくても、ステージングデプロイメントを含むパイプライン全体を再デプロイする必要があります。
* デプロイメント中に環境を更新することはできません。 実稼動環境に昇格する前に、ステージング環境でテストするために数日間一時停止した場合、実稼動環境はロックされたままになり、更新できなくなります。 このシナリオにより、依存しないタスク（例えば [ 環境変数 ](/help/getting-started/build-environment.md#environment-variables) の更新が不可能になります。

ステージング専用パイプラインと実稼動専用パイプラインは、専用のデプロイメントオプションを提供することで、これらのユースケースに対するソリューションを提供します。

* **ステージング専用デプロイメントパイプライン：** デプロイメントおよびテストが完了したら、実行が完了したステージング環境にのみデプロイします。 ステージング専用パイプラインは、標準の結合されたフルスタック実稼動パイプラインと同じように動作しますが、実稼動環境のデプロイメント手順（承認、スケジュール、デプロイ）はありません。
* **実稼動専用のデプロイメントパイプライン：** 成功したステージ実行を選択して、実稼動環境にのみデプロイします。 その後、アーティファクトを実稼動環境にデプロイします。 実稼動専用のパイプラインは、ビルドフェーズをバイパスしてステージのデプロイメントアーティファクトを再利用します。

フルスタック実稼動パイプラインの進行中は、ステージング専用パイプラインと実稼動専用パイプラインは実行されません（その逆も同様です）。 ステージング専用パイプラインとフルスタック実稼動パイプラインの両方に **Git の変更時**&#x200B;トリガーが設定され、同じブランチとリポジトリを指している場合、ステージング専用パイプラインのみが自動的に開始されます。実稼動専用パイプラインは、リポジトリに直接リンクされていないので、**`On Git Changes`** は開始されません。

実稼動専用パイプラインは、**Git の変更時** にリポジトリに直接リンクされていないので、手動でトリガーされます。

これらの専用パイプラインはより柔軟性がありますが、操作と推奨事項の詳細は次のとおりです。

>[!NOTE]
>
>実稼動専用パイプラインでは、常にステージ専用パイプラインのアーティファクトを使用します。 このプロセスは、標準の結合実稼動パイプラインがその間に他の何かをステージングにデプロイした場合でも、引き続き適用されます。
>
>* このようなシナリオは、不要なコードロールバックにつながる可能性があります。
>* アドビでは、実稼動専用パイプラインとステージング専用パイプラインの使用を開始したら、結合された標準の実稼動パイプラインの使用を停止することをお勧めします。
>* 引き続き標準の結合パイプラインとステージング専用パイプライン／実稼動専用パイプラインの両方を実行することにした場合は、コードのロールバックを回避するためにアーティファクトの再利用を念頭に置いてください。

## パイプラインの作成 {#pipeline-creation}

実稼動専用パイプラインとステージング専用パイプラインは、標準の結合された [ 実稼動パイプライン ](/help/using/production-pipelines.md) および [ 実稼動以外のパイプライン ](/help/using/non-production-pipelines.md) と同様の方法で作成されます。 詳しくは、これらのドキュメントを参照してください。

1. **パイプライン** ウィンドウで、「**パイプラインを追加**」をクリックします。

   * ステージング専用パイプラインを作成するには、「**実稼動以外のパイプラインを追加**」を選択します。
   * 実稼動専用パイプラインを作成するには、「**実稼動専用パイプラインを追加**」を選択します。

   ![実稼動専用パイプライン／ステージング専用パイプラインの作成](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>対応するパイプラインが既に存在する場合、特定のオプションはグレー表示される場合があります。
>
>* **実稼動専用パイプラインを追加** は、ステージ専用パイプラインがまだ存在しない場合は使用できません。
>* **実稼動パイプラインを追加** は、標準の結合パイプラインが既に存在する場合は使用できません。
>* プログラム別に許可される実稼動専用パイプラインとステージング専用パイプラインは 1 つだけです。

### ステージ専用パイプライン {#stage-only}

1. 「**実稼動以外のパイプラインを追加**」オプションを選択すると、「**実稼動以外のパイプラインを追加**」ダイアログボックスが開きます。
1. ステージのみのパイプラインを作成するには、パイプラインの「**適格なデプロイメント環境**」フィールドでステージ環境を選択します。
1. 残りのフィールドに入力します。
1. 「**続行**」をクリックします。

   ![実稼動専用パイプラインの作成](/help/assets/configure-pipelines/stage-only.png)

1. 「**ステージテスト**」タブで、ステージング環境で実行するテストを定義します。
1. 「**保存**」をクリックします。

   ![ステージング専用パイプラインのテストパラメーター](/help/assets/configure-pipelines/stage-only-test.png)

### 実稼動専用パイプライン {#prod-only}

1. 「**実稼動専用パイプラインを追加**」オプションを選択すると、「**実稼動専用パイプラインを追加**」ダイアログボックスが開きます。
1. **パイプライン名** フィールドに、必要な名前を入力します。 ダイアログボックスのその他のオプションと機能は、標準の結合パイプライン作成ダイアログボックスのオプションと同じように機能します。
1. ダイアログボックスの右下隅にある「**保存**」をクリックします。

   ![実稼動専用パイプラインの作成](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 実稼動専用パイプラインとステージ専用パイプラインの実行 {#running}

実稼動専用パイプラインとステージ専用パイプラインは、[ 他のすべてのパイプラインが実行される ](/help/using/managing-pipelines.md#running-pipelines) とほぼ同じ方法で実行されます。 詳しくは、そのドキュメントを参照してください。 ただし、これらのパイプラインには 2 つの新機能があります。

* ステージング専用および実稼動専用のパイプラインには、テストをスキップするための新しい [ 緊急モード ](#emergency-mode) が用意されています。
* 実稼動専用パイプラインの実行は、[ ステージ専用パイプライン ](#stage-only-run) の実行の詳細から直接トリガーできます。

### 緊急モード {#emergency-mode}

実稼動専用パイプラインとステージングオンラインパイプラインを開始する場合は、開始とその開始方法を確認するように求められます。

* **通常モード** は標準的な実行方法で、ステージテストの手順が含まれます。
* **緊急モード** ステージテスト手順をスキップします。

![ 緊急モード ](/help/assets/configure-pipelines/emergency-mode.png)

### ステージ専用パイプライン {#stage-only-run}

ステージング専用パイプラインは、標準の結合パイプラインとほとんど同じ方法で実行されます。ただし、実行の最後に、テスト手順の後に「**ビルドを昇格** ボタンが表示されます。 このボタンを使用すると、実行中にステージにデプロイされたアーティファクトを使用して実稼動専用のパイプライン実行を開始し、実稼動環境にデプロイできます。

![ステージング専用パイプラインの実行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

**ビルドを昇格** をクリックすると、関連するステージ専用パイプラインの実行を、通常または [ 緊急モード ](#emergency-mode) で確認するように求められます。

実稼動専用パイプラインが存在しない場合は、パイプラインを作成するよう求められます。

### 実稼動専用パイプライン {#prod-only-run}

実稼動専用パイプラインの場合は、実稼動環境にデプロイするソースアーティファクトを必ず特定してください。 これらの詳細については、**アーティファクトの準備** 手順を参照してください。 これらの実行に移動すると、詳細やログを確認できます。

![アーティファクトの詳細](/help/assets/configure-pipelines/prod-only-pipeline-run.png)
