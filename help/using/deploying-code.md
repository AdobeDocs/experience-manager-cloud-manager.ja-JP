---
title: コードのデプロイ
seo-title: コードのデプロイ
description: 'null'
seo-description: パイプライン（リポジトリ、環境、テスト環境）を設定したら、コードをデプロイする準備が整います。このページでは、この機能について詳しく見ていきます。
uuid: 4e3807e1-437e-4922-ba48-0bcadf293a99
contentOwner: jsyal
products: SG_EXPERIENCEMANAGER/CLOUDMANAGER
topic-tags: using
discoiquuid: 832a4647-9b83-4a9d-b373-30fe16092b15
translation-type: tm+mt
source-git-commit: ace032fbb26235d87d61552a11996ec2bb42abce
workflow-type: tm+mt
source-wordcount: '953'
ht-degree: 98%

---


# コードのデプロイ {#deploy-your-code}

## Cloud Manager でのコードのデプロイ {#deploying-code-with-cloud-manager}

実稼働パイプライン（リポジトリ、環境、テスト環境）を設定したら、コードをデプロイする準備が整います。

1. Cloud Manager で「**デプロイ**」をクリックして、デプロイメントプロセスを開始します。

   ![](assets/Deploy1.png)

1. **パイプライン実行**&#x200B;画面が表示されます。

   「**ビルド**」をクリックしてプロセスを開始します。

   ![](assets/Deploy2.png)

1. 完全なビルドプロセスによってコードがデプロイされます。

   ビルドプロセスには、以下のステージが含まれます。

   1. ステージのデプロイメント
   1. ステージテスト
   1. 実稼動のデプロイメント

   >[!NOTE]
   >
   >さらに、テスト条件のログを表示したり、結果を確認したりすることで、様々なデプロイメントプロセスから手順を確認できます。

   **ステージのデプロイメント**&#x200B;には、以下の手順が含まれます。

   * 検証：この手順では、現在使用できるリソース（設定済みの分岐が存在する場合など）を使用するようにパイプラインが設定され、環境が使用できることを確認します。
   * ビルドおよび単体テスト：この手順では、コンテナ化されたビルドプロセスを実行します。ビルド環境について詳しくは、[AEM アプリケーションプロジェクトの作成](create-an-application-project.md)を参照してください。
   * コードスキャン：この手順では、アプリケーションコードの品質を評価します。テストプロセスについて詳しくは、[テスト結果の理解](understand-your-test-results.md)を参照してください。
   * ステージへのデプロイ

   ![](assets/Stage_Deployment1.png)

   **ステージテスト**&#x200B;には、以下の手順が含まれます。

   * セキュリティテスト：この手順では、AEM 環境でのアプリケーションコードのセキュリティに対する影響を評価します。テストプロセスについて詳しくは、[テスト結果の理解](understand-your-test-results.md)を参照してください。
   * パフォーマンステスト：この手順では、アプリケーションコードのパフォーマンスを評価します。テストプロセスについて詳しくは、[テスト結果の理解](understand-your-test-results.md)を参照してください。

   ![](assets/Stage_Testing1.png)

   **実稼動のデプロイメント**&#x200B;には、以下の手順が含まれます。

   * **承認用アプリケーション**（有効な場合）
   * **実稼動のデプロイメントをスケジュール**（有効な場合）
   * **CSE サポート**（有効な場合）
   * **実稼動へのデプロイ**

   ![](assets/Prod_Deployment1.png)

   >[!NOTE]
   >
   >「**実稼動のデプロイメントをスケジュール**」は、パイプラインの設定時に有効になります。
   >
   >
   >Using this option, you can either schedule your production deployment or click **Now** to execute the production deployment immediately.
   >
   >
   >スケジュールされた日時は、ユーザーのタイムゾーンで指定されます。
   >
   >
   >「**確認**」をクリックして設定を検証します。

   ![](assets/Production_Deployment1.png)

   デプロイメントスケジュールを確認すると、コードのデプロイメントが完了します。

   上記の手順で「**今すぐ**」オプションが選択されている場合、以下の画面が表示されます。

   ![](assets/Production_Deployment2.png)

## デプロイメントプロセス {#deployment-process}

以下の節では、ステージフェーズおよび実稼動フェーズでの AEM および Dispatcher パッケージのデプロイ方法について説明します。

Cloud Manager は、ビルドプロセスによって生成されたすべての target/*.zip ファイルをステージの場所にアップロードします。これらのアーティファクトは、パイプラインのデプロイフェーズで、この場所から取得されます。

Cloud Manager が実稼動以外のトポロジにデプロイされる場合、目的はできるだけ早くデプロイメントを完了することです。そのため、アーティファクトは、以下のようにすべてのノードに同時にデプロイされます。

1. Cloud Manager は、各アーティファクトが AEM または Dispatcher パッケージであるかどうかを判断します。
1. Cloud Manager は、デプロイメント中に環境を分離するために、ロードバランサーからすべての Dispatcher を削除します。

   特に設定されている場合を除き、開発およびステージデプロイメントでのロードバランサーの変更、つまり、非実稼動パイプライン（開発環境用）と実稼動パイプライン（ステージ環境用）の両方のデタッチとアタッチの手順をスキップできます。

   ![](assets/load_balancer.png)

   >[!NOTE]
   >
   >この機能は、主に 1-1-1 のお客様が使用すると想定されています。

1. 各 AEM アーティファクトは、パッケージマネージャー API を介して各 AEM インスタンスにデプロイされ、パッケージの依存関係がデプロイメントの順序を決定します。

   パッケージを使用した新機能のインストール、インスタンス間のコンテンツの転送、リポジトリコンテンツのバックアップ方法について詳しくは、パッケージの使用方法を参照してください。

   >[!NOTE]
   >
   >すべての AEM アーティファクトは、オーサーとパブリッシャーの両方にデプロイされます。ノード専用の設定が必要な場合は、実行モードを使用する必要があります。特定の目的のために実行モードを使用して AEM インスタンスを調整できるようにする方法について詳しくは、実行モードを参照してください。

1. Dispatcher のアーティファクトは、以下のように各 Dispatcher にデプロイされます。

   1. 現在の設定はバックアップされ、一時的な場所にコピーされます。
   1. すべての設定は、不変ファイルを除いて削除されます。詳しくは、Dispatcher 設定の管理を参照してください。これにより、孤立したファイルが残らないようにディレクトリがクリアされます。
   1. アーティファクトは、`httpd` ディレクトリに抽出されます。不変ファイルは上書きされません。Git リポジトリ内の不変ファイルに対して加えた変更は、デプロイメント時に無視されます。これらのファイルは、AMS Dispatcher フレームワークのコアであり、変更できません。
   1. Apache が設定テストを実行します。エラーが見つからない場合は、サービスが再読み込みされます。エラーが発生した場合、設定がバックアップから復元され、サービスが再読み込みされて、エラーが Cloud Manager に再レポートされます。
   1. パイプライン設定で指定された各パスは、無効化または Dispatcher キャッシュからフラッシュされます。

   >[!NOTE]
   >Cloud Manager では、Dispatcher アーティファクトに完全なファイルセットが含まれていることが想定されています。すべての Dispatcher 設定ファイルが、Git リポジトリに存在する必要があります。ファイルやフォルダーが見つからない場合、デプロイメントに失敗します。

1. すべての AEM および Dispatcher パッケージのすべてのノードへのデプロイメントが正常に完了すると、Dispatcher がロードバランサーに再追加され、デプロイメントが完了します。

   >[!NOTE]
   >開発およびステージデプロイメントでのロードバランサーの変更、つまり、非実稼動パイプライン（開発環境用）と実稼動パイプライン（ステージ環境用）の両方のデタッチとアタッチの手順をスキップできます。

### 実稼動フェーズへのデプロイメント {#deployment-production-phase}

AEM サイト訪問者への影響を最小限に抑えるために、実稼動トポロジへのデプロイプロセスはわずかに異なります。

実稼動のデプロイメントは、通常、上記と同じ手順に従いますが、周期的な方法で実行します。

1. オーサーに AEM パッケージをデプロイします。
1. dispatcher1 をロードバランサーから分離します。
1. AEM パッケージを publish1 にデプロイし、Dispatcher を dispatcher1 にデプロイして、Dispatcher キャッシュをフラッシュします。
1. dispatcher1 をロードバランサーに戻します。
1. dispatcher1 がサービスを再開したら、dispatcher2 をロードバランサーから分離します。
1. AEM パッケージを publish2 にデプロイし、Dispatcher パッケージを dispatcher2 にデプロイして、Dispatcher キャッシュをフラッシュします。
1. dispatcher2 をロードバランサーに戻します。
このプロセスは、デプロイメントがトポロジのすべてのパブリッシャーおよび Dispatcher に到達するまで続行されます。


